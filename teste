import React, { useState } from "react";
import { useChamadoStore } from "../store/useChamadoStore";

interface Props {
  alertId: string;
}

const ConfirmationColumn: React.FC<Props> = ({ alertId }) => {
  const {
    chamados,
    initChamado,
    startChamado,
    confirmChamado,
    escalateChamado,
    completeChamado,
  } = useChamadoStore();

  const chamado = chamados[alertId];
  const [obs, setObs] = useState("");

  const handleStart = () => {
    initChamado(alertId);
  };

  const handleConfirm = () => {
    confirmChamado(alertId, obs);
    setObs("");
  };

  const handleEscalate = (level: 1 | 2 | 3 | 4) => {
    escalateChamado(alertId, level, obs);
    setObs("");
  };

  const handleComplete = () => {
    completeChamado(alertId, obs);
    setObs("");
  };

  return (
    <div style={{ border: "1px solid #ddd", padding: 10, margin: 10 }}>
      <h3>Chamado {alertId}</h3>
      <p>Status: {chamado?.status || "idle"}</p>
      <p>Tempo restante: {chamado?.timeRemaining ?? "-"}</p>
      <p>Nível atual: {chamado?.currentLevel ?? "-"}</p>

      <textarea
        placeholder="Observações"
        value={obs}
        onChange={(e) => setObs(e.target.value)}
      />

      <div style={{ marginTop: 10 }}>
        <button onClick={handleStart}>Iniciar</button>
        <button onClick={handleConfirm}>Confirmar</button>
        <button onClick={() => handleEscalate(1)}>Escalar N1</button>
        <button onClick={() => handleEscalate(2)}>Escalar N2</button>
        <button onClick={handleComplete}>Concluir</button>
      </div>
    </div>
  );
};

export default ConfirmationColumn;
