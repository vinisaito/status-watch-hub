def lambda_handler(event, context):
    print("Evento recebido:", event)
    
    connection_id = event["requestContext"]["connectionId"]
    route_key = event["requestContext"]["routeKey"]

    if route_key == "getAlerts":
        # (faz a query como você já tem)
        results = buscar_alertas_do_banco()

        apigw = boto3.client("apigatewaymanagementapi", endpoint_url=os.environ["WEBSOCKET_API_ENDPOINT"])
        apigw.post_to_connection(
            ConnectionId=connection_id,
            Data=json.dumps(results, ensure_ascii=False).encode("utf-8")
        )
        return {"statusCode": 200}
