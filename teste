socket.onmessage = (event) => {
  if (!event.data) {
    console.warn("[WS] ⚠️ Mensagem vazia ignorada");
    return;
  }

  try {
    const data = JSON.parse(event.data);

    if (!data || typeof data !== "object") {
      console.warn("[WS] ⚠️ Payload não é um objeto:", event.data);
      return;
    }

    if (!("chamado" in data)) {
      console.warn("[WS] ⚠️ Mensagem recebida sem 'chamado':", data);
      return;
    }

    // 👉 só aqui processa de fato
    handleChamadoUpdate(data);

  } catch (err) {
    console.error(
      "[WS] ❌ Erro ao processar mensagem:",
      err,
      "RAW:",
      event.data
    );
  }
};
